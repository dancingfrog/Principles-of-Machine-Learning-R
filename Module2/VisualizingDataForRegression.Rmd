---
title: 'Visualizing Data For Regression'
author: 'John'
date: '2020-06-23'
output: html_document
---

```{r setup, echo=FALSE, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

## Import packages
library(ggplot2)
library(repr)
library(hexbin)
library(GGally) ## Adds pair-wise scatter plots to ggplot2
options(repr.plot.width=4, repr.plot.height=4) # Set the initial plot area dimensions
```

## Visualizing Data For Regression

In this lab, you will learn how to use R to **visualize and explore data**. This process is also known as **exploratory data analysis**.

Before creating analytical models, a data scientist must develop an understanding of the properties and relationships in a dataset. There are two goals for data exploration and visualization. First to understand the relationships between the data columns. Second to identify features that may be useful for predicting labels in machine learning projects. Additionally, redundant, collinear features can be identified. Thus, visualization for data exploration is an essential data science skill.
In this lab you will explore two datasets.

Specifically, in this lab, your first goal is to explore a dataset that includes information about automobile pricing. In other labs you will use what you learn through visualization to create a solution that predicts the price of an automobile based on its characteristics. This type of predictive modeling, in which you attempt to predict a real numeric value, is known as **regression**; and it will be discussed in more detail later in the course. For now, the focus of this lab is on visually exploring the data to determine which features may be useful in predicting automobile prices.

This lesson is divided into several parts. In each part you will learn how to use the visualization tools available in Python to explore complex data. Specifically you will learn:

- **Summarizing and manipulating data**:
  * How large is it?
  * What columns are of interest?
  * What are the characteristics of the data derived from summary statistics and counts?
- **Developing multiple views of complex data** using multiple chart types. Exploring complex data requires multiple views to understand the many relationships. It is impossible to develop a complete understanding from just a few plots.
- **Overview of plotting with ggplot2** a powerful and flexible R plotting packages.
- **Overview of univariate plot types** is a review of creating these basic plots using ggplot2. These plot types allow you to study the distributional properties of the variables in your data set.
- **Overview of two dimensional plot types** is a review of creating basic plot types used to construct visualizations. These plots naturally display the relationship between two variables on the 2-d computer graphics display.
- **Using Aesthetics** is an overview of how to project additional plot dimensions using plot aesthetics. Using aesthetics provides a method for projecting additional dimensions onto the 2-d computer graphics display.
- **Faceted plotting** also know as conditioned plotting or lattice plotting, introduces a powerful method for visualizing higher dimensional data. Arrays of plots of subsets of the data are arranged on the 2-d computer graphics display.

## Load the dataset

Before you can start visualization, you must load the dataset. The code in the cell below loads the data and performs some data cleaning. You will work though data cleaning and preparation methods in other labs.

As a first step execute the code in the cell below to import the R packages you will need for the rest of this network. Execute this code

> **Note:** If you are running in Azure Notebooks, make sure that you run the code in the `setup.ipynb` notebook at the start of you session to ensure your environment is correctly configured.

```{r auto_prices}

if (file.exists("Automobile price data _Raw_.csv")) {
    dataFile <- "Automobile price data _Raw_.csv"
} else {
    dataFile <- file.choose()
}

read.auto <- function(file = dataFile){
    ## Read the csv file
    auto.price <- read.csv(file, header = TRUE, stringsAsFactors = FALSE)

    numcols <- switch(
      as.character((!exists("numcols") || is.na(numcols) || is.null(numcols))[1]), 
      "TRUE" = { # if numcols does not exist or is not populated ("TRUE"), 
        # use these defaults:
        c('price', 'bore', 'stroke', 'horsepower', 'peak.rpm')
      }, # else use existing values
      numcols)
    print(c("numeric columns:", numcols))
    
    for(col in c('price', 'bore', 'stroke', 'horsepower', 'peak.rpm')){
        for (idx in (1:length(auto.price[,col]))) {
          temp = auto.price[idx,col]
          if (temp == '?' || is.na(auto.price[idx,col])) {
            # Convert ? to NA
            auto.price[idx,col] = ifelse(temp == '?', NA, auto.price[idx,col])
            print(c(col, idx, auto.price[idx,col]))
          }
        }
      
        ## Coerce some character columns to numeric
        auto.price[,col] = as.numeric(auto.price[,col])
    }

    ## Remove cases or rows with missing values. 
    ## Keep the rows which do not have NAs. 
    auto.price = auto.price[complete.cases(auto.price[, numcols]), ]
    
    ## Drop some unneeded columns
    auto.price[,'symboling'] = NULL
    auto.price[,'normalized.losses'] = NULL
    
    return(auto.price)
}

cat_cols <- c('fuel.type', 'aspiration', 'num.of.doors', 'body.style', 
            'drive.wheels', 'engine.location', 'engine.type', 'num.of.cylinders')

plotcols <- c('price', 'city.mpg', 'curb.weight', 'engine.size', 'horsepower', 'fuel.type')

auto_prices <- read.auto()
print("all auto columns:")
colnames(auto_prices)
```

```{r explore}
head(auto_prices)

str(auto_prices)

summary(auto_prices)
```

```{r bar_charts}
plot_bars <- function(df){
    options(repr.plot.width=4, repr.plot.height=3.5) # Set the initial plot area dimensions
  
    print("character columns:")
    for(col in colnames(df)){
        if(is.character(df[,col])){
            print(col)
            p <- ggplot(df, aes_string(col)) + 
                       geom_bar(alpha = 0.6) + 
                       theme(axis.text.x = element_text(angle = 90, hjust = 1))
            print(p)
        }
    }
}

plot_bars(auto_prices)
```

```{r kernel_density_charts}
plot_dist <- function(df, plotcols){
    options(repr.plot.width=4, repr.plot.height=3) # Set the initial plot area dimensions
    for(col in plotcols){
        #if(is.numeric(df[,col])){
            p <- ggplot(df, aes_string(col)) + 
                       geom_density(color = 'blue') +
                       geom_rug()
            print(p)
        #}
    }
}

plot_dist(auto_prices, plotcols)
```

```{r scatter_plots}
plot_scatter_t <- function(df, cols, col_y = 'price', alpha = 1.0){
    options(repr.plot.width=4, repr.plot.height=3.5) # Set the initial plot area dimensions
    for(col in cols){
        p <- ggplot(df, aes_string(col, col_y)) + 
                   geom_point(alpha = alpha) +
                   ggtitle(paste('Scatter plot of', col_y, 'vs.', col))
        print(p)
    }
}

plot_scatter_t(auto_prices, plotcols, alpha = 0.2)
```

```{r hex_bin_charts}
plot_hex <- function(df, cols, col_y = 'price', bins = 30){
    options(repr.plot.width=4, repr.plot.height=3.5) # Set the initial plot area dimensions
    for(col in cols){
        p <- ggplot(df, aes_string(col, col_y)) + 
                   geom_hex(show.legend = TRUE, bins = bins) +
                   ggtitle(paste('2-D hexbin plot of', col_y, 'vs.', col))
        print(p)
    }
}

plot_hex(auto_prices, plotcols, bins = 10)
```

```{r box_plots}
plot_box <- function(df, cols, col_y = 'price'){
    options(repr.plot.width=4, repr.plot.height=3.5) # Set the initial plot area dimensions
    for(col in cols){
        p <- ggplot(df, aes_string(col, col_y)) + 
                   geom_boxplot() +
                   ggtitle(paste('Box plot of', col, 'vs.', col_y))
        print(p)
    }
}

plot_box(auto_prices, cat_cols)
```

```{r violin_plots}
plot_violin <- function(df, cols, col_y = 'price', bins = 30){
    options(repr.plot.width=4, repr.plot.height=3.5) # Set the initial plot area dimensions
    for(col in cols){
        p <- ggplot(df, aes_string(col, col_y)) + 
                   geom_violin() +
                   ggtitle(paste('Violin plot of', col, 'vs.', col_y))
        print(p)
    }
}

plot_violin(auto_prices, cat_cols)
```
```{r marker_shapes}
plot_scatter_sp <- function(df, cols, col_y = 'price', alpha = 1.0){
    options(repr.plot.width=5, repr.plot.height=3.5) # Set the initial plot area dimensions
    for(col in cols){
        p <- ggplot(df, aes_string(col, col_y)) + 
                   geom_point(aes(shape = factor(fuel.type)), alpha = alpha) +
                   ggtitle(paste('Scatter plot of', col_y, 'vs.', col, '\n with shape by fuel type'))
        print(p)
    }
}

plot_scatter_sp(auto_prices, plotcols, alpha = 0.2)
```

```{r marker_sizes}
plot_scatter_sp_sz = function(df, cols, col_y = 'price', alpha = 1.0){
    options(repr.plot.width=5, repr.plot.height=3.5) # Set the initial plot area dimensions
    df$curb.weight.2 = df$curb.weight**2
    for(col in cols){
        p = ggplot(df, aes_string(col, col_y)) + 
                   geom_point(aes(shape = factor(fuel.type), size = curb.weight.2), alpha = alpha) +
                   ggtitle(paste('Scatter plot of', col_y, 'vs.', col, '\n with shape by fuel type'))
        print(p)
    }
}

plot_scatter_sp_sz(auto_prices, plotcols, alpha = 0.1)
```

```{r marker_colors}
plot_scatter_sp_sz_cl = function(df, cols, col_y = 'price', alpha = 1.0){
    options(repr.plot.width=5, repr.plot.height=3.5) # Set the initial plot area dimensions
    df$curb.weight.2 = df$curb.weight**2
    for(col in cols){
        p = ggplot(df, aes_string(col, col_y)) + 
                   geom_point(aes(shape = factor(fuel.type), size = curb.weight.2, color = aspiration), 
                              alpha = alpha) +
                   ggtitle(paste('Scatter plot of', col_y, 'vs.', col, 
                                 '\n with shape by fuel type',
                                 '\n and color by aspiration'))
        print(p)
    }
}

plot_scatter_sp_sz_cl(auto_prices, plotcols, alpha = 0.2)
```
```{r pair_wise_scatter_plots}
options(repr.plot.width=6, repr.plot.height=6) # Set the initial plot area dimensions
plot_ggp <- ggpairs(auto_prices,
      columns = plotcols,
      aes(color = fuel.type, alpha = 0.1),
      lower = list(continuous = wrap("points", alpha = 0.3), combo = wrap("facethist", binwidth=0.8)),
      upper = list(continuous = ggally_density, combo = wrap("box")),
      progress = FALSE)
```
```{r render, echo=FALSE, fig.width=14, fig.height=14}
options(warn = -1)
print(plot_ggp)
```

